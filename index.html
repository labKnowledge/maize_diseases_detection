<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroEye: Corn Disease Classifier</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'agro-green': '#2E7D32',
                        'agro-yellow': '#FBC02D',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .bg-gradient {
            background-image: linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%);
        }
    </style>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%232E7D32'/><path d='M30 70 Q50 30 70 70' stroke='%23FBC02D' stroke-width='8' fill='none'/><circle cx='50' cy='50' r='10' fill='%23FBC02D'/></svg>" />
</head>
<body class="bg-gradient min-h-screen p-4 font-sans text-gray-800">
    <header class="max-w-4xl mx-auto mb-8">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <svg class="w-12 h-12 mr-4" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#2E7D32"/>
                    <path d="M30 70 Q50 30 70 70" stroke="#FBC02D" stroke-width="8" fill="none"/>
                    <circle cx="50" cy="50" r="10" fill="#FBC02D"/>
                </svg>
                <h1 class="text-4xl font-bold text-agro-green">AgroEye</h1>
            </div>
            <nav>
                <button onclick="toggleModal('aboutModal')" class="text-agro-green hover:text-agro-yellow transition duration-300">About</button>
                <button onclick="toggleModal('contactModal')" class="ml-4 text-agro-green hover:text-agro-yellow transition duration-300">Contact</button>
            </nav>
        </div>
    </header>

    <div class="max-w-4xl mx-auto">
        <div class="bg-white p-8 rounded-2xl shadow-lg w-full transition-all duration-300 hover:shadow-xl mb-8">
            <h2 class="text-3xl font-bold mb-4 text-center text-agro-green">Corn Disease Classifier</h2>
            <p class="text-center mb-6 text-gray-600">Powered by advanced AI, AgroEye helps farmers identify corn diseases quickly and accurately.</p>
            
            <div class="mb-6">
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button onclick="openCamera()" class="flex-1 bg-agro-green text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300 flex items-center justify-center transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Open Camera
                    </button>
                    <div class="relative flex-1">
                        <input accept="image/*" type='file' id="input_button" class="hidden"/>
                        <label for="input_button" class="cursor-pointer flex items-center justify-center w-full text-white
                            py-3 px-4 rounded-lg border-0 font-semibold bg-agro-yellow hover:bg-yellow-600 transition duration-300 transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Choose File
                        </label>
                    </div>
                </div>
            </div>

            <div class="mb-6 relative">
                <img id="img1" src="image.jpg" alt="Uploaded or captured corn leaf image" class="w-full h-80 object-cover rounded-lg shadow-md transition-all duration-300" />
                <div id="overlay" class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg opacity-0 transition-opacity duration-300">
                    <p class="text-white text-xl font-semibold">Image ready</p>
                </div>
            </div>

            <div id="cameraContainer" class="mb-6 hidden">
                <video id="camera" class="w-full h-80 object-cover rounded-lg shadow-md mb-4"></video>
                <div class="flex justify-between items-center">
                    <button id="switchCamera" class="bg-agro-green text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                        </svg>
                    </button>
                    <button id="capture" class="bg-agro-yellow text-white py-2 px-4 rounded-lg hover:bg-yellow-600 transition duration-300 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </button>
                </div>
            </div>

            <button onclick="predict()" class="w-full bg-agro-green text-white py-4 px-6 rounded-lg hover:bg-green-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 text-lg font-bold">
                Predict Disease
            </button>

            <div id="result" class="mt-6 text-center text-xl font-semibold opacity-0 transition-all duration-300"></div>
        </div>

        <div id="details" class="bg-white p-8 rounded-2xl shadow-lg w-full transition-all duration-300 hover:shadow-xl mt-8 hidden">
            <h2 id="detailsTitle" class="text-3xl font-bold mb-6 text-agro-green"></h2>
            <div id="detailsContent" class="text-gray-700"></div>
        </div>
    </div>

     <!-- About Modal -->
    <div id="aboutModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-agro-green">About AgroEye</p>
                    <button class="modal-close cursor-pointer z-50" onclick="toggleModal('aboutModal')">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </button>
                </div>
                <p class="mb-4">AgroEye is an innovative project dedicated to bringing the power of Machine Learning to farmers. Our mission is to revolutionize agricultural practices through cutting-edge technology.</p>
                <p class="mb-4">What sets AgroEye apart is our commitment to accuracy. Our model has been trained with field-collected images, ensuring that our predictions are grounded in real-world agricultural conditions.</p>
                <p>By leveraging this carefully curated dataset, AgroEye provides farmers with highly accurate disease identification tools, empowering them to make informed decisions and protect their crops effectively.</p>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-agro-green">Contact Us</p>
                    <button class="modal-close cursor-pointer z-50" onclick="toggleModal('contactModal')">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </button>
                </div>
                <p class="mb-4">AgroEye is proudly powered by the Eligapris ML Project. To learn more or get in touch, visit our GitHub:</p>
                <a href="https://github.com/eligapris" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700 transition duration-300">https://github.com/eligapris</a>
                <p class="mt-4 mb-4">The Eligapris ML Project is at the forefront of integrating Machine Learning and AI into daily life activities. Our research focuses on:</p>
                <ul class="list-disc list-inside mb-4">
                    <li>On-device AI solutions</li>
                    <li>Maximizing ML and AI applications in various fields</li>
                    <li>Innovative approaches to everyday problem-solving using AI</li>
                </ul>
                <p>Join us in our mission to make AI accessible and beneficial for everyone!</p>
            </div>
        </div>
    </div>


    <footer class="max-w-4xl mx-auto bg-agro-green text-white py-6 text-center mt-12">
        <p class="text-sm">AgroEye: Empowering farmers with AI-driven insights</p>
        <p class="text-xs mt-2">Â© 2024 AgroEye. All rights reserved.</p>
    </footer>

    <script>

        // Modal functionality
        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.toggle('opacity-0');
            modal.classList.toggle('pointer-events-none');
            document.body.classList.toggle('modal-active');
        }

        // Close modal if clicking outside of it
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                toggleModal(event.target.id);
            }
        }


        let image = document.getElementById('img1');
        let input_button = document.getElementById('input_button');
        let resultElement = document.getElementById('result');
        let overlay = document.getElementById('overlay');
        let detailsElement = document.getElementById('details');
        let detailsTitle = document.getElementById('detailsTitle');
        let detailsContent = document.getElementById('detailsContent');
        let classesDetailed;
        let camera = document.getElementById('camera');
        let cameraContainer = document.getElementById('cameraContainer');
        let captureBtn = document.getElementById('capture');
        let switchCameraBtn = document.getElementById('switchCamera');
        let stream;
        let facingMode = "environment";

        // Load the classes-detailed.json file
        fetch('classes-detailed.json')
            .then(response => response.json())
            .then(data => {
                classesDetailed = data;
            })
            .catch(error => console.error('Error loading classes-detailed.json:', error));

        input_button.onchange = evt => {
            const [file] = input_button.files;
            if (file) {
                image.src = URL.createObjectURL(file);
                resetUI();
            }
        }

        function openCamera() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode } })
                .then(function(str) {
                    stream = str;
                    camera.srcObject = stream;
                    camera.play();
                    cameraContainer.classList.remove('hidden');
                    image.classList.add('hidden');
                })
                .catch(function(error) {
                    console.error("Error accessing the camera", error);
                    alert("Unable to access the camera. Please make sure you've granted the necessary permissions.");
                });
        }

        switchCameraBtn.onclick = function() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            facingMode = facingMode === "user" ? "environment" : "user";
            openCamera();
        }

        captureBtn.onclick = function() {
            let canvas = document.createElement('canvas');
            canvas.width = camera.videoWidth;
            canvas.height = camera.videoHeight;
            canvas.getContext('2d').drawImage(camera, 0, 0);
            image.src = canvas.toDataURL('image/jpeg');
            resetUI();
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }

        function resetUI() {
            resultElement.textContent = '';
            resultElement.classList.remove('opacity-100');
            detailsElement.classList.add('hidden');
            cameraContainer.classList.add('hidden');
            image.classList.remove('hidden');
            overlay.classList.add('opacity-100');
            setTimeout(() => {
                overlay.classList.remove('opacity-100');
            }, 1500);
        }

        async function predict() {
            resultElement.textContent = 'Analyzing...';
            resultElement.classList.add('opacity-100', 'animate-pulse', 'text-blue-500');
            detailsElement.classList.add('hidden');
            try {
                const model = await tf.loadGraphModel('./model.json');
                let example = tf.browser.fromPixels(image, 3).cast('float32');
                example = example.expandDims(0);

                let prediction = await model.predict(example);
                let class_scores = await prediction.data();
                let max_score_id = class_scores.indexOf(Math.max(...class_scores));
                let classes = Object.keys(classesDetailed.classes);
                let predictedClass = classes[max_score_id];

                resultElement.textContent = `Prediction: ${predictedClass.replace('_', ' ')}`;
                resultElement.classList.remove('animate-pulse', 'text-blue-500');
                resultElement.classList.add('text-green-600');

                displayDetails(predictedClass);
            } catch (error) {
                console.error('Prediction error:', error);
                resultElement.textContent = 'Error during prediction. Please try again.';
                resultElement.classList.remove('animate-pulse', 'text-blue-500');
                resultElement.classList.add('text-red-600');
            }
        }

        function displayDetails(classLabel) {
            if (classesDetailed && classesDetailed.details[classLabel]) {
                const details = classesDetailed.details[classLabel];
                detailsTitle.textContent = `${classLabel.replace('_', ' ')} Details`;
                
                let content = '';
                if (classLabel === 'Healthy_Leaf') {
                    content += `<p class="mb-2"><strong>Description:</strong> ${details.description}</p>`;
                    content += `<p class="mb-2"><strong>Characteristics:</strong></p>`;
                    content += '<ul class="list-disc list-inside mb-2">';
                    details.characteristics.forEach(char => {
                        content += `<li>${char}</li>`;
                    });
                    content += '</ul>';
                    content += `<p><strong>Importance:</strong> ${details.importance}</p>`;
                } else {
                    content += `<p class="mb-2"><strong>Causative Agent:</strong> ${details.causative_agent}</p>`;
                    content += `<p class="mb-2"><strong>Symptoms:</strong></p>`;
                    content += '<ul class="list-disc list-inside mb-2">';
                    details.symptoms.forEach(symptom => {
                        content += `<li>${symptom}</li>`;
                    });
                    content += '</ul>';
                    content += `<p class="mb-2"><strong>Environmental Conditions:</strong></p>`;
                    content += '<ul class="list-disc list-inside mb-2">';
                    details.environmental_conditions.forEach(condition => {
                        content += `<li>${condition}</li>`;
                    });
                    content += '</ul>';
                    content += `<p class="mb-2"><strong>Impact:</strong> ${details.impact}</p>`;
                    if (details.notes) {
                        content += `<p class="mb-2"><strong>Additional Notes:</strong></p>`;
                        content += '<ul class="list-disc list-inside">';
                        details.notes.forEach(note => {
                            content += `<li>${note}</li>`;
                        });
                        content += '</ul>';
                    }
                }
                
                detailsContent.innerHTML = content;
                detailsElement.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>